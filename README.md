# C-学习之路

- [C-学习之路](#c-学习之路)
  - [C 程序结构](#c-程序结构)
    - [C Hello World 实例](#c-hello-world-实例)
    - [编译&执行C程序](#编译执行c程序)
  - [C 基本语法](#c-基本语法)
    - [C 的令牌（Token）](#c-的令牌token)
    - [分号 **;**](#分号-)
    - [注释](#注释)
    - [标识符](#标识符)
    - [关键字](#关键字)
      - [C99新增关键字](#c99新增关键字)
      - [C11新增关键字](#c11新增关键字)
    - [C中的空格](#c中的空格)
  - [C 数据类型](#c-数据类型)
    - [整数类型](#整数类型)
    - [浮点类型](#浮点类型)
    - [void类型](#void类型)
  - [C 变量](#c-变量)
    - [C中的变量定义](#c中的变量定义)
    - [C中的变量声明](#c中的变量声明)
    - [C中的左值（Lvalues）和右值（Rvalues）](#c中的左值lvalues和右值rvalues)
  - [C 常量](#c-常量)
    - [整数常量](#整数常量)
    - [浮点常量](#浮点常量)

## C 程序结构

### C Hello World 实例

C程序主要包括以下部分：

- 预处理器指令
- 函数
- 变量
- 语句&表达式
- 注释

现在看一段简单的代码，可以输出单词“Hello World”：

```c
#include <stdio.h>

int main() {
    /* 我的第一个C程序 */
    printf("Hello, World! \n");

    return 0;
}
```

接下来讲解一下这段程序：

1. 程序的第一行`#include <stdio.h>`是预处理器指令，高速C编译器在实际编译之前要包含stdio.h。
2. 下一行`int main()`是主函数，程序从这里开始执行。
3. 下一行`/*...*/`将会被编译器忽略，这里放置程序的注释内容。它们被称为程序的注释。
4. 下一行`printf("Hello, World! \n")`是C中另一个可用的函数，会在屏幕上显示信息“Hello，World！”。
5. 下一行`return 0`终止`main()`函数，并返回值0。

### 编译&执行C程序

接下来看看如何把源代码保存在一个文件中，以及如何编译并运行它。下面是简单的步骤：

1. 打开一个文本编辑器，添加上述代码。
2. 保存文件为[1-1.c](code\1-1.c)。
3. 打开终端，进入到保存文件所在的目录。
4. 键入`gcc 1-1.c`，输入回车，编译代码。
5. 如果代码中没有错误，命令提示符会跳到下一行，并生成[a.exe](code/a.exe)可执行文件。
6. 现在，键入[a.exe](code/a.exe)来执行程序。
7. 可以看到终端上显示“Hello，World!”。

![编译&运行](README_files/1.jpg)

请确保路径中已包含gcc编译器，并确保在包含源文件`1-1.c`的目录中运行它。  
如果是多个C代码的源码文件，编译方法如下：

> gcc test1.c test2.c -o main.exe  
./main.exe

`test1.c`与`test2.c`是两个源代码文件。

## C 基本语法

### C 的令牌（Token）

C程序由各种令牌组成，令牌可以是关键字、标识符、常量、字符串值，或者是一个符号。例如，下面的C语句包括五个令牌：

```c
printf("Hello, World! \n");
```

这五个令牌分别是：

```c
printf
(
  "Hello, World! \n"
)
;
```

### 分号 **;**

在C程序中，分号是语句结束符。也就是说，每个语句必须以分号结束。它表明一个逻辑实体的结束。  
例如，下面是两个不同的语句：

```c
printf("Hello, World! \n");
return 0;
```

### 注释

C语言有两种注释方式：

```c
// 单行注释
```

以`//`开始的单行注释，这种注释可以单独占一行。

```c
/* 单行注释 */
/*
  多行注释
  多行注释
  多行注释
 */
```

`/* */`这种格式的注释可以单行或者多行。  
不可以在注释内嵌套注释，注释也不能出现在字符串或者字符值中。

### 标识符

C标识符是用来标识变量、函数，或任何其他用户自定义项目的名称。一个标识符以字母`A-Z`或`a-z`或下划线`_`开始，后面跟零个或多个`字母`、`下划线`和`数字`（0-9）。  
C标识符内不允许出现标点字符，比如`@`、`$` 和 `%`。C 是区分大小写的编程语言。因此，在 C 中，`Manpower` 和 `manpower` 是两个不同的标识符。

### 关键字

下表列出了C中的保留字。这些保留字不能作为常量名、变量名或其他标识符名称。

|关键字|说明|
|--|--|
|auto|声明自动变量|
|break|跳出当前循环|
|case|开关语句分支|
|char|声明字符型变量或函数返回值类型|
|const|定义常量，如果一个变量被const修饰，那么它的值就不能再被改变|
|continue|结束当前循环，开始下一轮循环|
|default|开关语句中的“其他”分支
|do|循环语句的循环体|
|double|声明双精度浮点型变量或者函数返回值类型|
|else|条件语句否定分支（与if连用）|
|enum|声明枚举类型|
|extern|声明变量或函数是在其它文件或本文件的其他位置定义|
|float|声明浮点型变量或函数返回值类型|
|for|一种循环语句|
|goto|无条件跳转语句|
|if|条件语句|
|int|声明整型变量或函数|
|long|声明长整型变量或函数返回值类型|
|register|声明寄存器变量|
|return|子程序返回语句（可以带参数，也可不带参数）|
|short|声明短整型变量或函数|
|signed|声明有符号类型变量或函数|
|sizeof|计算数据类型或变量长度（即所占字节数）|
|static|声明静态变量|
|struct|声明结构体类型|
|switch|用于开关语句|
|typedef|用以给数据类型取别名|
|ungigned|声明无符号类型变量或函数|
|union|声明共用体类型|
|void|声明函数无返回值或无参数，声明无类型指针|
|volatile|说明变量在程序执行中可被隐含地改变|
|while|循环语句的循环条件|

#### C99新增关键字

|||||||
|--|--|--|--|--|--|
|_Bool|_Complex|_Imaginary|inline|restrict|

#### C11新增关键字

||||||||
|--|--|--|--|--|--|--|
|_Alignas|_Alignof|_Atomic|_Generic|_Noreturn|_Static_assert|_Thread_local|

### C中的空格

只包含空格的行，被称为空白行，可能带有注释，C编译器会完全忽视它。  
在C中，空格用于描述空白符、制表符、换行符和注释。空格分隔语句的各个部分，让编译器能识别语句中的某个元素（比如`int`）在哪里结束，下一个元素在哪里开始。因此，在下面的语句中：

```c
int age;
```

在这里，`int`和`age`之间必须至少有一个空白字符（通常是一个空白符），这样编译器才能够区分它们。另一个方面，在下面的语句中：

```c
fruit = apples + oranges; // 获取水果的总数
```

`fruit`和`=`，或者`=`和`apples`之间的空格字符不是必需的，但是为了增强可读性，可以根据需要适当增加一些空格。

## C 数据类型

在C语言中，数据类型指的是用于声明不同类型的变量或函数的一个广泛的系统。变量的类型决定了变量储存所占用的空间，以及如何解释存储的位模式。  
C中的类型可分为以下几种：

|序号|类型与描述|
|--|--|
|1| **基本类型：** 它们是算术类型，包括两种类型：整数类型和浮点数类型。|
|2| **枚举类型：** 它们也是算术类型，被用来定义在程序中只能赋予其一定的离散整数值的变量。|
|3| **void类型：** 类型说明符void表明没有可用的值。|
|4| **派生类型：** 它们包括：指针类型、数组类型、结构类型、共用体类型和函数类型。|

数组类型和结构类型统称为聚合类型。函数类型指的是函数返回值的类型。

### 整数类型

下表列出了关于标准整数类型的存储大小和值范围的细节：

|类型|存储大小|值范围|
|--|--|--|
|char|1字节|-128到127或0到255|
|unsigned char|1字节|0到255|
|signed char|1字节|-128到127|
|int|2或4字节|-32,768 到 32,767 或 -2,147,483,648 到 2,147,483,647|
|unsigned int|2或4字节|0 到 65,535 或 0 到 4,294,967,295|
|short|2字节|-32,768 到 32,767|
|unsigned short|2字节|0 到 65,535|
|long|4字节|-2,147,483,648 到 2,147,483,647|
|unsigned long|4字节|0 到 4,294,967,295|

**注意：** 各种类型的存储大小与系统位数有关，但目前通用的以64位系统为主。  
以下列出了32位系统与64位系统的存储大小的差别（window相同）：

![存储差别](README_files/2.jpg)

为了得到某个类型或某个变量在特定平台上的准确大小，可以使用`sizeof`运算符。表达式`sizeof(type)`得到对象或类型的存储字节大小。下面的实例演示了获取int类型的大小：

```c
#include <stdio.h>
#include <limits.h>

int main() {
    printf("int 存储大小：%lu \n", sizeof(int));

    return 0;
}
```

`%lu`为32位无符号整型。  
当在Window上编译并执行上面的程序时，输入命令：
> gcc -fexec-charset=gbk .\3-1.c -o 3-1.exe  
> .\3-1.exe

运行结果：
> int 存储大小：4

`-fexec-charset=`的作用是更改编码格式，默认是`utf-8`，在Window中更改编码为`gbk`，则不会出现中文乱码。

### 浮点类型

下表列出了关于标准浮点类型的存储大小、值范围和精度的细节：

|类型|存储大小|值范围|精度|
|--|--|--|--|
|float|4字节|1.2E-38 到 3.4E+38|6位有效位|
|double|8字节|2.3E-308 到 1.7E+308|15位有效位|
|long double|16字节|3.4E-4932 到 1.1E+4932|19位有效位|

头文件`float.h`定义了宏，在程序中可以使用这些值和其他有关实数二进制表示的细节。下面的实例将输出浮点类型占用的储存空间以及它的范围值：

```c
#include <stdio.h>
#include <float.h>

int main() {
    printf("float 存储最大字节数：%lu \n", sizeof(float));
    printf("float 最小值： %E \n", FLT_MIN);
    printf("float 最大值：%E\n", FLT_MAX);
    printf("精度值：%d\n", FLT_DIG);

    return 0;
}
```

`%E`表示以指数形式输出单、双精度实数。  
当在Window上编译并执行上面的程序时，运行结果：
> float 存储最大字节数：4  
float 最小值： 1.175494E-038  
float 最大值：3.402823E+038  
精度值：6

### void类型

void类型指定没有可用的值。它通常用于以下三种情况下：

|序号|类型与描述|
|--|--|
|1| **函数返回为空** C中有各种函数都不返回值，或者可以说它们返回空。不返回值的函数的返回类型为空。例如`void exit(int status);`|
|2| **函数参数为空** C中有各种函数不接受任何参数。不带参数的函数可以接受一个`void`。例如`int rand(void);`
|3| **指针指向void** 类型为`void *`的指针代表对象的地址，而不是类型。例如，内存分配函数`void *malloc(size_t size);`返回指向`void`的指针，可以转换为任何数据类型|

## C 变量

变量其实只不过是程序可操作的存储区的名称。C中每个变量都有特定的类型，类型决定了变量存储的大小和布局，该范围内的值都可以存储在内存中，运算符可应用于变量上。  
变量的名称可以由字母、数字和下划线字符组成。它必须以字母或下划线开头。大写字母和小写字母是不同的，因为C是大小写敏感的。以下是几种基本的变量类型：
|类型|描述|
|--|--|
|char|通常是一个字节（八位），这是一个整数类型|
|int|整型，4个字节，取值范围 -2147483648 到 2147483647|
|float|单精度浮点值。单精度是这样的格式，1位符号，8位指数，23位小数![float](README_files/3.jpg)|
|double|双精度浮点值。双精度是1位符号，11位指数，52位小数![double](README_files/4.jpg)|
|void|表示类型的缺失|

C语言也允许定义各种其他类型的变量，比如枚举、指针、数组、结构、共用体等等，这个在后面讲解。

### C中的变量定义

变量定义就是告诉编译器在何处创建变量的存储，以及如何创建变量的存储。变量定义指定一个数据类型，并包含了该类型的一个或多个变量的列表，如下所示：

```c
type variable_list;
```

在这里，**type** 必须是一个有效的C数据类型，可以是`char`、`w_char`、`int`、`float`、`double`或任何用户自定义的对象，**variable_list** 可以由一个或多个标识符名称组成，多个标识符之间用逗号分隔。下面列出几个有效的声明：

```c
int i, j, k;
char c, ch;
float f, salary;
double d;
```

行`int i, j, k;`声明并定义了变量`i`、`j`和`k`，这指示编译器创建类型为`int`的名为`i`、`j`、`k`的变量。  
变量可以在声明的时候被初始化（指定一个初始值）。初始化器由一个等号，后跟一个常量表达式组成，如下所示：

```c
type variable_name = value;
```

下面列举几个实例：

```c
extern int d = 3, f = 5; // d和f的声明和初始化
int d =3, f = 5; // 定义并初始化d和f
byte z =22; //定义并初始化z
char x = 'x'; //变量x的值为'x'
```

不带初始化的定义：带有静态存储持续时间的变量会被隐式初始化为`NULL`（所有字节的值都是0），其他所有变量的初始值是未定义的。

### C中的变量声明

变量声明向编译器保证变量以指定的类型和名称的存在，这样编译器在不需要知道变量完整细节的情况下也能继续进一步的编译。变量声明只在编译时有它的意义，在程序连接时编译器需要实际的变量声明。  
变量的声明有两种情况：

1. 一种是需要建立存储空间的。例如：`int a`在声明的时候就已经建立了存储空间。
2. 另一种是不需要建立存储空间的，通过使用`extern`关键字声明变量名而不定义它。例如：`extern int a`其中变量`a`可以在别的文件中定义的。除非有`extern`关键字，否则都是变量的定义。

```c
extern int i; // 声明，不是定义
int i; // 声明，也是定义
```

尝试下面的实例，其中，变量在头部已经被声明，但是定义与初始化在主函数内：

```c
#include <stdio.h>

// 函数外定义变量x和y
int x;
int y;
int add_two_num()
{
    // 函数内声明变量x和y为外部变量
    extern int x;
    extern int y;
    // 给外部变量（全局变量）x和y赋值
    x = 1;
    y = 2;
    return x+y;
}

int main()
{
    int result;
    // 调用函数add_two_num
    result = add_two_num();

    printf("result 为：%d", result);
    return 0;
}
```

当上面的代码被编译和运行时，运行结果：
> result 为：3

如果需要在一个源文件中引用另外一个源文件中定义的变量，只需要在引用的文件中将变量加上`extern`关键字的声明即可。

```c
#include <stdio.h>
/* 外部变量声明 */
extern int x;
extern int y;
int add_two_num()
{
    return x+y;
}
```

```c
#include <stdio.h>

/* 定义两个全局变量 */
int x = 1;
int y = 2;
int add_two_num();
int main()
{
    int result;
    result = add_two_num();
    printf("result 为：%d\n", result);
    return 0;
}
```

当上面的代码被编译和运行时，运行结果：
> gcc -fexec-charset=gbk .\4-2.c .\4-3.c -o 4-2+3.exe  
> .\4-2+3.exe
> result 为：3

### C中的左值（Lvalues）和右值（Rvalues）

C中有两种类型的表达式：

1. **左值（Lvalues）：** 指向内存位置的表达式被称为左值（Lvalue）表达式。左值可以出现在赋值号的左边或右边。
2. **右值（Rvalues）：** 术语右值（Rvalue）指的是存储在内存中某些地址的数值。右值是不能对其进行赋值的表达式，也就是说，右值可以出现在赋值号的右边，但不能出现在赋值号的左边。

变量是左值，因此可以出现在赋值号的左边。数值型的字面值是右值，因此不能被赋值，不能出现在赋值号的左边。下面是一个有效的语句：

```c
int g = 20;
```

但是下面这个就不是一个有效的语句，会在编译时产生错误：

```c
10 = 20;
```

## C 常量

常量是固定值，在程序执行期间不会改变。这些固定的值，又叫做 **字面量** 。  
常量可以是任何的基本数据类型，比如整型常量、浮点常量、字符常量、字符串字面量，也有枚举常量。  
**常量** 就像是常规的变量，只不过常量的值在定义后不能进行修改。  

### 整数常量

整数常量可以是十进制、八进制或者十六进制的常量。前缀指定基数：`0x`或`0X`表示十六进制，`0`表示八进制，不带前缀则默认表示十进制。  
整数常量也可以带一个后缀，后缀是`U`和`L`的组合，`U`表示无符号整数（unsigned），`L`表示长整数（long）。后缀可以是大写，也可以是小写，U和L的顺序任意。
下面列举几个整数常量的实例：

```c
212 /* 合法的 */
215u /* 合法的 */
0xFeeL /* 合法的 */
078 /* 非法的：8不是八进制的数字 */
032UU /* 非法的：不能重复后缀 */
```

以下是各种类型的整数常量的实例：

```c
85 /* 十进制 */
0213 /* 八进制 */
0x4b /* 十六进制 */
30 /* 整数 */
30u /* 无符号整数 */
30l /* 长整数 */
30ul /* 无符号长整数 */
```

### 浮点常量

浮点常量是由整数部分、小数点、小数部分和指数部分组成。可以使用小数形式或者指数形式来表示浮点常量。  
当使用小数形式表示时，必须包含整数部分、小数部分，或者同时包含两者。当使用指数形式时，必须包含小数点、指数，或者同时包含两者。带符号的指数是用e或E引入的。  
